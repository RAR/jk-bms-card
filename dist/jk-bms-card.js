function e(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function t(e,t,n,l){var s,a=arguments.length,i=a<3?t:null===l?l=Object.getOwnPropertyDescriptor(t,n):l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,l);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(i=(a<3?s(i):a>3?s(t,n,i):s(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i}"function"==typeof SuppressedError&&SuppressedError;
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const n=globalThis,l=n.ShadowRoot&&(void 0===n.ShadyCSS||n.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s=Symbol(),a=new WeakMap;let i=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(l&&void 0===e){const n=void 0!==t&&1===t.length;n&&(e=a.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&a.set(t,e))}return e}toString(){return this.cssText}};const r=(e,...t)=>{const n=1===e.length?e[0]:t.reduce(((t,n,l)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+e[l+1]),e[0]);return new i(n,e,s)},c=l?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>new i("string"==typeof e?e:e+"",void 0,s))(t)})(e):e
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,{is:o,defineProperty:_,getOwnPropertyDescriptor:h,getOwnPropertyNames:d,getOwnPropertySymbols:g,getPrototypeOf:p}=Object,u=globalThis,v=u.trustedTypes,m=v?v.emptyScript:"",f=u.reactiveElementPolyfillSupport,b=(e,t)=>e,y={toAttribute(e,t){switch(t){case Boolean:e=e?m:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},w=(e,t)=>!o(e,t),x={attribute:!0,type:String,converter:y,reflect:!1,useDefault:!1,hasChanged:w};Symbol.metadata??=Symbol("metadata"),u.litPropertyMetadata??=new WeakMap;let S=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=x){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),l=this.getPropertyDescriptor(e,n,t);void 0!==l&&_(this.prototype,e,l)}}static getPropertyDescriptor(e,t,n){const{get:l,set:s}=h(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:l,set(t){const a=l?.call(this);s?.call(this,t),this.requestUpdate(e,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??x}static _$Ei(){if(this.hasOwnProperty(b("elementProperties")))return;const e=p(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(b("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(b("properties"))){const e=this.properties,t=[...d(e),...g(e)];for(const n of t)this.createProperty(n,e[n])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,n]of t)this.elementProperties.set(e,n)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const n=this._$Eu(e,t);void 0!==n&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(c(e))}else void 0!==e&&t.push(c(e));return t}static _$Eu(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(l)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const l of t){const t=document.createElement("style"),s=n.litNonce;void 0!==s&&t.setAttribute("nonce",s),t.textContent=l.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$ET(e,t){const n=this.constructor.elementProperties.get(e),l=this.constructor._$Eu(e,n);if(void 0!==l&&!0===n.reflect){const s=(void 0!==n.converter?.toAttribute?n.converter:y).toAttribute(t,n.type);this._$Em=e,null==s?this.removeAttribute(l):this.setAttribute(l,s),this._$Em=null}}_$AK(e,t){const n=this.constructor,l=n._$Eh.get(e);if(void 0!==l&&this._$Em!==l){const e=n.getPropertyOptions(l),s="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:y;this._$Em=l,this[l]=s.fromAttribute(t,e.type)??this._$Ej?.get(l)??null,this._$Em=null}}requestUpdate(e,t,n){if(void 0!==e){const l=this.constructor,s=this[e];if(n??=l.getPropertyOptions(e),!((n.hasChanged??w)(s,t)||n.useDefault&&n.reflect&&s===this._$Ej?.get(e)&&!this.hasAttribute(l._$Eu(e,n))))return;this.C(e,t,n)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:n,reflect:l,wrapped:s},a){n&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,a??t??this[e]),!0!==s||void 0!==a)||(this._$AL.has(e)||(this.hasUpdated||n||(t=void 0),this._$AL.set(e,t)),!0===l&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,n]of e){const{wrapped:e}=n,l=this[t];!0!==e||this._$AL.has(t)||void 0===l||this.C(t,void 0,n,l)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach((e=>e.hostUpdate?.())),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach((e=>e.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach((e=>this._$ET(e,this[e]))),this._$EM()}updated(e){}firstUpdated(e){}};S.elementStyles=[],S.shadowRootOptions={mode:"open"},S[b("elementProperties")]=new Map,S[b("finalized")]=new Map,f?.({ReactiveElement:S}),(u.reactiveElementVersions??=[]).push("2.1.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const C=globalThis,$=C.trustedTypes,k=$?$.createPolicy("lit-html",{createHTML:e=>e}):void 0,A="$lit$",E=`lit$${Math.random().toFixed(9).slice(2)}$`,M="?"+E,O=`<${M}>`,U=document,D=()=>U.createComment(""),V=e=>null===e||"object"!=typeof e&&"function"!=typeof e,P=Array.isArray,I="[ \t\n\f\r]",N=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,T=/-->/g,j=/>/g,z=RegExp(`>|${I}(?:([^\\s"'>=/]+)(${I}*=${I}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),L=/'/g,R=/"/g,H=/^(?:script|style|textarea|title)$/i,B=(e=>(t,...n)=>({_$litType$:e,strings:t,values:n}))(1),F=Symbol.for("lit-noChange"),W=Symbol.for("lit-nothing"),J=new WeakMap,q=U.createTreeWalker(U,129);function K(e,t){if(!P(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==k?k.createHTML(t):t}const G=(e,t)=>{const n=e.length-1,l=[];let s,a=2===t?"<svg>":3===t?"<math>":"",i=N;for(let t=0;t<n;t++){const n=e[t];let r,c,o=-1,_=0;for(;_<n.length&&(i.lastIndex=_,c=i.exec(n),null!==c);)_=i.lastIndex,i===N?"!--"===c[1]?i=T:void 0!==c[1]?i=j:void 0!==c[2]?(H.test(c[2])&&(s=RegExp("</"+c[2],"g")),i=z):void 0!==c[3]&&(i=z):i===z?">"===c[0]?(i=s??N,o=-1):void 0===c[1]?o=-2:(o=i.lastIndex-c[2].length,r=c[1],i=void 0===c[3]?z:'"'===c[3]?R:L):i===R||i===L?i=z:i===T||i===j?i=N:(i=z,s=void 0);const h=i===z&&e[t+1].startsWith("/>")?" ":"";a+=i===N?n+O:o>=0?(l.push(r),n.slice(0,o)+A+n.slice(o)+E+h):n+E+(-2===o?t:h)}return[K(e,a+(e[n]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),l]};class Y{constructor({strings:e,_$litType$:t},n){let l;this.parts=[];let s=0,a=0;const i=e.length-1,r=this.parts,[c,o]=G(e,t);if(this.el=Y.createElement(c,n),q.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(l=q.nextNode())&&r.length<i;){if(1===l.nodeType){if(l.hasAttributes())for(const e of l.getAttributeNames())if(e.endsWith(A)){const t=o[a++],n=l.getAttribute(e).split(E),i=/([.?@])?(.*)/.exec(t);r.push({type:1,index:s,name:i[2],strings:n,ctor:"."===i[1]?te:"?"===i[1]?ne:"@"===i[1]?le:ee}),l.removeAttribute(e)}else e.startsWith(E)&&(r.push({type:6,index:s}),l.removeAttribute(e));if(H.test(l.tagName)){const e=l.textContent.split(E),t=e.length-1;if(t>0){l.textContent=$?$.emptyScript:"";for(let n=0;n<t;n++)l.append(e[n],D()),q.nextNode(),r.push({type:2,index:++s});l.append(e[t],D())}}}else if(8===l.nodeType)if(l.data===M)r.push({type:2,index:s});else{let e=-1;for(;-1!==(e=l.data.indexOf(E,e+1));)r.push({type:7,index:s}),e+=E.length-1}s++}}static createElement(e,t){const n=U.createElement("template");return n.innerHTML=e,n}}function Z(e,t,n=e,l){if(t===F)return t;let s=void 0!==l?n._$Co?.[l]:n._$Cl;const a=V(t)?void 0:t._$litDirective$;return s?.constructor!==a&&(s?._$AO?.(!1),void 0===a?s=void 0:(s=new a(e),s._$AT(e,n,l)),void 0!==l?(n._$Co??=[])[l]=s:n._$Cl=s),void 0!==s&&(t=Z(e,s._$AS(e,t.values),s,l)),t}class Q{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:n}=this._$AD,l=(e?.creationScope??U).importNode(t,!0);q.currentNode=l;let s=q.nextNode(),a=0,i=0,r=n[0];for(;void 0!==r;){if(a===r.index){let t;2===r.type?t=new X(s,s.nextSibling,this,e):1===r.type?t=new r.ctor(s,r.name,r.strings,this,e):6===r.type&&(t=new se(s,this,e)),this._$AV.push(t),r=n[++i]}a!==r?.index&&(s=q.nextNode(),a++)}return q.currentNode=U,l}p(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class X{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,n,l){this.type=2,this._$AH=W,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=l,this._$Cv=l?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Z(this,e,t),V(e)?e===W||null==e||""===e?(this._$AH!==W&&this._$AR(),this._$AH=W):e!==this._$AH&&e!==F&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>P(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==W&&V(this._$AH)?this._$AA.nextSibling.data=e:this.T(U.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:n}=e,l="number"==typeof n?this._$AC(e):(void 0===n.el&&(n.el=Y.createElement(K(n.h,n.h[0]),this.options)),n);if(this._$AH?._$AD===l)this._$AH.p(t);else{const e=new Q(l,this),n=e.u(this.options);e.p(t),this.T(n),this._$AH=e}}_$AC(e){let t=J.get(e.strings);return void 0===t&&J.set(e.strings,t=new Y(e)),t}k(e){P(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,l=0;for(const s of e)l===t.length?t.push(n=new X(this.O(D()),this.O(D()),this,this.options)):n=t[l],n._$AI(s),l++;l<t.length&&(this._$AR(n&&n._$AB.nextSibling,l),t.length=l)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class ee{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,l,s){this.type=1,this._$AH=W,this._$AN=void 0,this.element=e,this.name=t,this._$AM=l,this.options=s,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=W}_$AI(e,t=this,n,l){const s=this.strings;let a=!1;if(void 0===s)e=Z(this,e,t,0),a=!V(e)||e!==this._$AH&&e!==F,a&&(this._$AH=e);else{const l=e;let i,r;for(e=s[0],i=0;i<s.length-1;i++)r=Z(this,l[n+i],t,i),r===F&&(r=this._$AH[i]),a||=!V(r)||r!==this._$AH[i],r===W?e=W:e!==W&&(e+=(r??"")+s[i+1]),this._$AH[i]=r}a&&!l&&this.j(e)}j(e){e===W?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class te extends ee{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===W?void 0:e}}class ne extends ee{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==W)}}class le extends ee{constructor(e,t,n,l,s){super(e,t,n,l,s),this.type=5}_$AI(e,t=this){if((e=Z(this,e,t,0)??W)===F)return;const n=this._$AH,l=e===W&&n!==W||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,s=e!==W&&(n===W||l);l&&this.element.removeEventListener(this.name,this,n),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class se{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Z(this,e)}}const ae=C.litHtmlPolyfillSupport;ae?.(Y,X),(C.litHtmlVersions??=[]).push("3.3.0");const ie=globalThis;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class re extends S{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,n)=>{const l=n?.renderBefore??t;let s=l._$litPart$;if(void 0===s){const e=n?.renderBefore??null;l._$litPart$=s=new X(t.insertBefore(D(),e),e,void 0,n??{})}return s._$AI(e),s})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return F}}re._$litElement$=!0,re.finalized=!0,ie.litElementHydrateSupport?.({LitElement:re});const ce=ie.litElementPolyfillSupport;ce?.({LitElement:re}),(ie.litElementVersions??=[]).push("4.2.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const oe=e=>(t,n)=>{void 0!==n?n.addInitializer((()=>{customElements.define(e,t)})):customElements.define(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,_e={attribute:!0,type:String,converter:y,reflect:!1,hasChanged:w},he=(e=_e,t,n)=>{const{kind:l,metadata:s}=n;let a=globalThis.litPropertyMetadata.get(s);if(void 0===a&&globalThis.litPropertyMetadata.set(s,a=new Map),"setter"===l&&((e=Object.create(e)).wrapped=!0),a.set(n.name,e),"accessor"===l){const{name:l}=n;return{set(n){const s=t.get.call(this);t.set.call(this,n),this.requestUpdate(l,s,e)},init(t){return void 0!==t&&this.C(l,void 0,e,t),t}}}if("setter"===l){const{name:l}=n;return function(n){const s=this[l];t.call(this,n),this.requestUpdate(l,s,e)}}throw Error("Unsupported decorator location: "+l)};function de(e){return(t,n)=>"object"==typeof n?he(e,t,n):((e,t,n)=>{const l=t.hasOwnProperty(n);return t.constructor.createProperty(n,e),l?Object.getOwnPropertyDescriptor(t,n):void 0})(e,t,n)}const ge="jk-bms-content-card-editor",pe="jk-bms-card";var ue;!function(e){e.delta_cell_voltage="delta_cell_voltage",e.balancing_current="balancing_current",e.power="power",e.balance_trigger_voltage="balance_trigger_voltage",e.total_runtime_formatted="total_runtime_formatted",e.charging="charging",e.discharging="discharging",e.balancer="balancer",e.heater="heater",e.total_voltage="total_voltage",e.total_battery_capacity_setting="total_battery_capacity_setting",e.total_charging_cycle_capacity="total_charging_cycle_capacity",e.average_cell_voltage="average_cell_voltage",e.current="current",e.state_of_charge="state_of_charge",e.capacity_remaining="capacity_remaining",e.charging_cycles="charging_cycles",e.power_tube_temperature="power_tube_temperature",e.min_voltage_cell="min_voltage_cell",e.max_voltage_cell="max_voltage_cell",e.errors="errors",e.cell_voltage_1="cell_voltage_1",e.cell_voltage_2="cell_voltage_2",e.cell_voltage_3="cell_voltage_3",e.cell_voltage_4="cell_voltage_4",e.cell_voltage_5="cell_voltage_5",e.cell_voltage_6="cell_voltage_6",e.cell_voltage_7="cell_voltage_7",e.cell_voltage_8="cell_voltage_8",e.cell_voltage_9="cell_voltage_9",e.cell_voltage_10="cell_voltage_10",e.cell_voltage_11="cell_voltage_11",e.cell_voltage_12="cell_voltage_12",e.cell_voltage_13="cell_voltage_13",e.cell_voltage_14="cell_voltage_14",e.cell_voltage_15="cell_voltage_15",e.cell_voltage_16="cell_voltage_16",e.cell_voltage_17="cell_voltage_17",e.cell_voltage_18="cell_voltage_18",e.cell_voltage_19="cell_voltage_19",e.cell_voltage_20="cell_voltage_20",e.cell_voltage_21="cell_voltage_21",e.cell_voltage_22="cell_voltage_22",e.cell_voltage_23="cell_voltage_23",e.cell_voltage_24="cell_voltage_24",e.cell_voltage_25="cell_voltage_25",e.cell_voltage_26="cell_voltage_26",e.cell_voltage_27="cell_voltage_27",e.cell_voltage_28="cell_voltage_28",e.cell_voltage_29="cell_voltage_29",e.cell_voltage_30="cell_voltage_30",e.cell_voltage_31="cell_voltage_31",e.cell_voltage_32="cell_voltage_32",e.cell_voltage_33="cell_voltage_33",e.cell_voltage_34="cell_voltage_34",e.cell_voltage_35="cell_voltage_35",e.cell_voltage_36="cell_voltage_36",e.cell_voltage_37="cell_voltage_37",e.cell_voltage_38="cell_voltage_38",e.cell_voltage_39="cell_voltage_39",e.cell_voltage_40="cell_voltage_40",e.cell_voltage_41="cell_voltage_41",e.cell_voltage_42="cell_voltage_42",e.cell_voltage_43="cell_voltage_43",e.cell_voltage_44="cell_voltage_44",e.cell_voltage_45="cell_voltage_45",e.cell_voltage_46="cell_voltage_46",e.cell_voltage_47="cell_voltage_47",e.cell_voltage_48="cell_voltage_48",e.cell_voltage_49="cell_voltage_49",e.cell_voltage_50="cell_voltage_50",e.cell_voltage_51="cell_voltage_51",e.cell_voltage_52="cell_voltage_52",e.cell_voltage_53="cell_voltage_53",e.cell_voltage_54="cell_voltage_54",e.cell_voltage_55="cell_voltage_55",e.cell_voltage_56="cell_voltage_56",e.cell_voltage_57="cell_voltage_57",e.cell_voltage_58="cell_voltage_58",e.cell_voltage_59="cell_voltage_59",e.cell_voltage_60="cell_voltage_60",e.cell_voltage_61="cell_voltage_61",e.cell_voltage_62="cell_voltage_62",e.cell_voltage_63="cell_voltage_63",e.cell_voltage_64="cell_voltage_64",e.cell_voltage_65="cell_voltage_65",e.cell_voltage_66="cell_voltage_66",e.cell_voltage_67="cell_voltage_67",e.cell_voltage_68="cell_voltage_68",e.cell_voltage_69="cell_voltage_69",e.cell_voltage_70="cell_voltage_70",e.cell_voltage_71="cell_voltage_71",e.cell_voltage_72="cell_voltage_72",e.cell_voltage_73="cell_voltage_73",e.cell_voltage_74="cell_voltage_74",e.cell_voltage_75="cell_voltage_75",e.cell_voltage_76="cell_voltage_76",e.cell_voltage_77="cell_voltage_77",e.cell_voltage_78="cell_voltage_78",e.cell_voltage_79="cell_voltage_79",e.cell_voltage_80="cell_voltage_80",e.cell_voltage_81="cell_voltage_81",e.cell_voltage_82="cell_voltage_82",e.cell_voltage_83="cell_voltage_83",e.cell_voltage_84="cell_voltage_84",e.cell_voltage_85="cell_voltage_85",e.cell_voltage_86="cell_voltage_86",e.cell_voltage_87="cell_voltage_87",e.cell_voltage_88="cell_voltage_88",e.cell_voltage_89="cell_voltage_89",e.cell_voltage_90="cell_voltage_90",e.cell_voltage_91="cell_voltage_91",e.cell_voltage_92="cell_voltage_92",e.cell_voltage_93="cell_voltage_93",e.cell_voltage_94="cell_voltage_94",e.cell_voltage_95="cell_voltage_95",e.cell_voltage_96="cell_voltage_96",e.cell_resistance_1="cell_resistance_1",e.cell_resistance_2="cell_resistance_2",e.cell_resistance_3="cell_resistance_3",e.cell_resistance_4="cell_resistance_4",e.cell_resistance_5="cell_resistance_5",e.cell_resistance_6="cell_resistance_6",e.cell_resistance_7="cell_resistance_7",e.cell_resistance_8="cell_resistance_8",e.cell_resistance_9="cell_resistance_9",e.cell_resistance_10="cell_resistance_10",e.cell_resistance_11="cell_resistance_11",e.cell_resistance_12="cell_resistance_12",e.cell_resistance_13="cell_resistance_13",e.cell_resistance_14="cell_resistance_14",e.cell_resistance_15="cell_resistance_15",e.cell_resistance_16="cell_resistance_16",e.cell_resistance_17="cell_resistance_17",e.cell_resistance_18="cell_resistance_18",e.cell_resistance_19="cell_resistance_19",e.cell_resistance_20="cell_resistance_20",e.cell_resistance_21="cell_resistance_21",e.cell_resistance_22="cell_resistance_22",e.cell_resistance_23="cell_resistance_23",e.cell_resistance_24="cell_resistance_24",e.cell_resistance_25="cell_resistance_25",e.cell_resistance_26="cell_resistance_26",e.cell_resistance_27="cell_resistance_27",e.cell_resistance_28="cell_resistance_28",e.cell_resistance_29="cell_resistance_29",e.cell_resistance_30="cell_resistance_30",e.cell_resistance_31="cell_resistance_31",e.cell_resistance_32="cell_resistance_32",e.cell_resistance_33="cell_resistance_33",e.cell_resistance_34="cell_resistance_34",e.cell_resistance_35="cell_resistance_35",e.cell_resistance_36="cell_resistance_36",e.cell_resistance_37="cell_resistance_37",e.cell_resistance_38="cell_resistance_38",e.cell_resistance_39="cell_resistance_39",e.cell_resistance_40="cell_resistance_40",e.cell_resistance_41="cell_resistance_41",e.cell_resistance_42="cell_resistance_42",e.cell_resistance_43="cell_resistance_43",e.cell_resistance_44="cell_resistance_44",e.cell_resistance_45="cell_resistance_45",e.cell_resistance_46="cell_resistance_46",e.cell_resistance_47="cell_resistance_47",e.cell_resistance_48="cell_resistance_48",e.cell_resistance_49="cell_resistance_49",e.cell_resistance_50="cell_resistance_50",e.cell_resistance_51="cell_resistance_51",e.cell_resistance_52="cell_resistance_52",e.cell_resistance_53="cell_resistance_53",e.cell_resistance_54="cell_resistance_54",e.cell_resistance_55="cell_resistance_55",e.cell_resistance_56="cell_resistance_56",e.cell_resistance_57="cell_resistance_57",e.cell_resistance_58="cell_resistance_58",e.cell_resistance_59="cell_resistance_59",e.cell_resistance_60="cell_resistance_60",e.cell_resistance_61="cell_resistance_61",e.cell_resistance_62="cell_resistance_62",e.cell_resistance_63="cell_resistance_63",e.cell_resistance_64="cell_resistance_64",e.cell_resistance_65="cell_resistance_65",e.cell_resistance_66="cell_resistance_66",e.cell_resistance_67="cell_resistance_67",e.cell_resistance_68="cell_resistance_68",e.cell_resistance_69="cell_resistance_69",e.cell_resistance_70="cell_resistance_70",e.cell_resistance_71="cell_resistance_71",e.cell_resistance_72="cell_resistance_72",e.cell_resistance_73="cell_resistance_73",e.cell_resistance_74="cell_resistance_74",e.cell_resistance_75="cell_resistance_75",e.cell_resistance_76="cell_resistance_76",e.cell_resistance_77="cell_resistance_77",e.cell_resistance_78="cell_resistance_78",e.cell_resistance_79="cell_resistance_79",e.cell_resistance_80="cell_resistance_80",e.cell_resistance_81="cell_resistance_81",e.cell_resistance_82="cell_resistance_82",e.cell_resistance_83="cell_resistance_83",e.cell_resistance_84="cell_resistance_84",e.cell_resistance_85="cell_resistance_85",e.cell_resistance_86="cell_resistance_86",e.cell_resistance_87="cell_resistance_87",e.cell_resistance_88="cell_resistance_88",e.cell_resistance_89="cell_resistance_89",e.cell_resistance_90="cell_resistance_90",e.cell_resistance_91="cell_resistance_91",e.cell_resistance_92="cell_resistance_92",e.cell_resistance_93="cell_resistance_93",e.cell_resistance_94="cell_resistance_94",e.cell_resistance_95="cell_resistance_95",e.cell_resistance_96="cell_resistance_96",e.temperature_sensor_1="temperature_sensor_1",e.temperature_sensor_2="temperature_sensor_2",e.temperature_sensor_3="temperature_sensor_3",e.temperature_sensor_4="temperature_sensor_4"}(ue||(ue={}));const ve={[ue.state_of_charge]:"battery_soc",[ue.capacity_remaining]:"battery_capacity_remaining",[ue.errors]:"errors_bitmask",[ue.balance_trigger_voltage]:"balancer_trigger_voltage",[ue.cell_voltage_1]:"cell_voltage_01",[ue.cell_voltage_2]:"cell_voltage_02",[ue.cell_voltage_3]:"cell_voltage_03",[ue.cell_voltage_4]:"cell_voltage_04",[ue.cell_voltage_5]:"cell_voltage_05",[ue.cell_voltage_6]:"cell_voltage_06",[ue.cell_voltage_7]:"cell_voltage_07",[ue.cell_voltage_8]:"cell_voltage_08",[ue.cell_voltage_9]:"cell_voltage_09",[ue.cell_resistance_1]:"cell_resistance_01",[ue.cell_resistance_2]:"cell_resistance_02",[ue.cell_resistance_3]:"cell_resistance_03",[ue.cell_resistance_4]:"cell_resistance_04",[ue.cell_resistance_5]:"cell_resistance_05",[ue.cell_resistance_6]:"cell_resistance_06",[ue.cell_resistance_7]:"cell_resistance_07",[ue.cell_resistance_8]:"cell_resistance_08",[ue.cell_resistance_9]:"cell_resistance_09"},me={"jk-ble":{[ue.charging]:"charge_switch",[ue.discharging]:"discharge_switch",[ue.balancer]:"balance_switch"},"jk-rs485":{[ue.total_voltage]:"battery_voltage",[ue.current]:"battery_current",[ue.power]:"battery_power",[ue.delta_cell_voltage]:"cell_delta_voltage",[ue.average_cell_voltage]:"cell_average_voltage",[ue.min_voltage_cell]:"cell_voltage_min_cell_number",[ue.max_voltage_cell]:"cell_voltage_max_cell_number",[ue.total_battery_capacity_setting]:"battery_capacity_total_setting",[ue.power_tube_temperature]:"temperature_powertube"},ecoworthy:{[ue.average_cell_voltage]:"cell_average_voltage",[ue.total_battery_capacity_setting]:"total_capacity",[ue.temperature_sensor_1]:"cell_temperature_1",[ue.temperature_sensor_2]:"cell_temperature_2",[ue.temperature_sensor_3]:"cell_temperature_3",[ue.temperature_sensor_4]:"cell_temperature_4",[ue.power_tube_temperature]:"mosfet_temperature",[ue.charging]:"charge_switch",[ue.discharging]:"discharge_switch"},eg4:{[ue.temperature_sensor_1]:"cell_temperature_1",[ue.temperature_sensor_2]:"cell_temperature_2",[ue.temperature_sensor_3]:"cell_temperature_3",[ue.temperature_sensor_4]:"cell_temperature_4",[ue.power_tube_temperature]:"mosfet_temperature"},jbd:{[ue.temperature_sensor_1]:"temperature_1",[ue.temperature_sensor_2]:"temperature_2",[ue.temperature_sensor_3]:"temperature_3",[ue.temperature_sensor_4]:"temperature_4"},pace:{[ue.temperature_sensor_1]:"battery_temperature_1",[ue.temperature_sensor_2]:"battery_temperature_2",[ue.temperature_sensor_3]:"battery_temperature_3",[ue.temperature_sensor_4]:"battery_temperature_4",[ue.power_tube_temperature]:"mosfet_temperature"},"seplos-v1v2":{[ue.temperature_sensor_1]:"temperature_1",[ue.temperature_sensor_2]:"temperature_2",[ue.temperature_sensor_3]:"temperature_3",[ue.temperature_sensor_4]:"temperature_4",[ue.power_tube_temperature]:"mosfet_temperature"},"seplos-v3":{[ue.temperature_sensor_1]:"cell_temp_1",[ue.temperature_sensor_2]:"cell_temp_2",[ue.temperature_sensor_3]:"cell_temp_3",[ue.temperature_sensor_4]:"cell_temp_4",[ue.power_tube_temperature]:"power_temp"},basen:{[ue.power_tube_temperature]:"temperature_mosfet"},deye:{},other:{}};var fe={title:"JK BMS Card",description:"A customizable Home Assistant card to emulate the JK BMS screen",version:"Version"},be={source:"Data source",bmsType:"BMS type",title:"Title",prefix:"Prefix of the sensors",cellCount:"Number of cells",cellColumns:"Number of columns",cellLayout:"Cell Layout",layout:"Layout",deltaVoltageUnit:"Delta Voltage Unit",cellColorMode:"Cell Color Mode",cellOrientation:"Cell Orientation",minCellVoltage:"Min Cell Voltage (V)",maxCellVoltage:"Max Cell Voltage (V)",tempUnit:"Temperature unit",manualAssignment:"Manual entity assignment",tempSensorsCount:"Number of temperature sensors available",hasHeater:"Heater option is used"},ye={charge:"Charge",discharge:"Discharge",balance:"Balance",heater:"Heater"},we={power:"Power:",capacity:"Capacity:",cycleCapacity:"Cycle Cap:",averageCellV:"Avg Cell V:",balanceCurrent:"Balance Cur:",stateOfCharge:"SOC:",remainingAmps:"Remaining:",cycles:"Cycles:",delta:"Delta Voltage:",mosfetTemp:"MOS Temp:",temperature_sensor_1:"Temp. 1:",temperature_sensor_2:"Temp. 2:",temperature_sensor_3:"Temp. 3:",temperature_sensor_4:"Temp. 4:"},xe={common:fe,config:be,switches:ye,stats:we},Se={title:"Карта JK BMS",description:"Налаштовувана картка Home Assistant для емуляції екрану JK BMS",version:"Версія"},Ce={source:"Джерело даних",bmsType:"Тип BMS",title:"Заголовок",prefix:"Префікс сенсорів",cellCount:"Кількість комірок",cellColumns:"Кількість стовпців",cellLayout:"Розташування комірок",layout:"Макет",deltaVoltageUnit:"Одиниця дельта напруги",cellColorMode:"Режим кольору комірок",cellOrientation:"Орієнтація комірок",minCellVoltage:"Мін. напруга комірки (В)",maxCellVoltage:"Макс. напруга комірки (В)",tempUnit:"Одиниця температури",manualAssignment:"Ручне призначення сутності",tempSensorsCount:"Кількість доступних датчиків температури",hasHeater:"Використовується опція підігріву"},$e={charge:"Заряд",discharge:"Розряд",balance:"Баланс",heater:"Підігрів"},ke={power:"Потужність:",capacity:"Ємність:",cycleCapacity:"Ємність циклу:",averageCellV:"Середня напруга комірки:",balanceCurrent:"Струм балансування:",stateOfCharge:"Заряд:",remainingAmps:"Залишок (Аг):",cycles:"Цикли:",delta:"Дельта напруги:",mosfetTemp:"Температура MOS:",temperature_sensor_1:"Темп. 1:",temperature_sensor_2:"Темп. 2:",temperature_sensor_3:"Темп. 3:",temperature_sensor_4:"Темп. 4:"},Ae={common:Se,config:Ce,switches:$e,stats:ke};const Ee={hass:null},Me={en:Object.freeze({__proto__:null,common:fe,config:be,default:xe,stats:we,switches:ye}),uk:Object.freeze({__proto__:null,common:Se,config:Ce,default:Ae,stats:ke,switches:$e})};function Oe(e,t="",n=""){try{let l=localStorage.getItem("selectedLanguage");null===l&&(l=localStorage.getItem("assist_debug_language")),null===l&&(l=localStorage.getItem("editor-language")),null===l&&(l="en"),l=l.replace(/['"]+/g,"").replace("-","_");const s="".concat(Ee.hass?.selectedLanguage||Ee.hass?.locale?.language||Ee.hass?.language||l);let a;try{a=e?.split(".").reduce(((e,t)=>e[t]),Me[s])}catch(t){a=e?.split(".")?.reduce(((e,t)=>e[t]),Me.en)}return void 0===a&&(a=e?.split(".")?.reduce(((e,t)=>e[t]),Me.en)),""!==t&&""!==n&&(a=a.replace(t,n)),a}catch(t){return e}}const Ue=(e,t)=>{const n=e?.entities[t]?.toString()?.trim();if(n&&n.length>1)return n;if("yambms"===e?.source){let n=e.bmsType??"jk-ble";"jk"===n&&(n="jk-ble");const l=me[n];if(l){const e=l[t];if(e)return e}const s=ve[t];if(s)return s}return t?.toString()},De=(e,t,n,l="sensor")=>{if(!e)return;e.stopPropagation();const s=Ue(t,n),a=s.includes("sensor.")||s.includes("switch.")||s.includes("number.")?s:l+"."+t?.prefix+"_"+s;let i=new CustomEvent("hass-more-info",{detail:{entityId:a},composed:!0});e.target.dispatchEvent(i)},Ve=(e,t,n,l=2,s="",a="sensor")=>{const i=Ue(t,n);if(!i)return s;const r=i.includes("sensor.")||i.includes("switch.")||i.includes("number.")?i:"".concat(a,".").concat(t.prefix,"_").concat(i),c=e?.states[r],o=c?.state,_=Number(o);return isNaN(_)?o??s:_.toFixed(l)},Pe=(e,t)=>{if(t?.tempUnit&&"auto"!==t.tempUnit)return t.tempUnit;const n=[ue.temperature_sensor_1,ue.temperature_sensor_2,ue.power_tube_temperature];for(const l of n){const n=Ue(t,l);if(!n)continue;const s=n.includes("sensor.")?n:"sensor.".concat(t.prefix,"_").concat(n),a=e?.states[s];if(a?.attributes?.unit_of_measurement)return a.attributes.unit_of_measurement}return"°C"},Ie=e=>{const t=new Set;if(!e?.prefix)return t;const n=(n,l="sensor")=>{const s=Ue(e,n);s&&t.add(s.includes(".")?s:"".concat(l,".").concat(e.prefix,"_").concat(s))};[ue.delta_cell_voltage,ue.balancing_current,ue.power,ue.total_voltage,ue.total_battery_capacity_setting,ue.total_charging_cycle_capacity,ue.average_cell_voltage,ue.current,ue.state_of_charge,ue.capacity_remaining,ue.charging_cycles,ue.power_tube_temperature,ue.min_voltage_cell,ue.max_voltage_cell,ue.errors,ue.total_runtime_formatted].forEach((e=>n(e))),[ue.charging,ue.discharging,ue.balancer,ue.heater].forEach((e=>n(e,"switch"))),n(ue.balance_trigger_voltage,"number");for(let t=1;t<=(e.tempSensorsCount??0);t++){const e=ue["temperature_sensor_".concat(t)];e&&n(e)}for(let t=1;t<=(e.cellCount??16);t++){const e=ue["cell_voltage_".concat(t)];e&&n(e);const l=ue["cell_resistance_".concat(t)];l&&n(l)}return t},Ne=(e,t,n)=>{for(const l of n)if(e.states[l]!==t.states[l])return!0;return!1},Te=(e="V",t)=>{const n="string"==typeof t?parseFloat(t):t;if(isNaN(n))return"-";if("mV"===e)return"".concat((1e3*n).toFixed(0)," mV");const l=n.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:3});return"".concat(l," V")};var je,ze,Le,Re,He,Be,Fe,We,Je,qe,Ke,Ge,Ye,Ze,Qe;let Xe=class extends re{constructor(){super(...arguments),this.minCellId="",this.maxCellId="",this.maxDeltaV=0,this.shouldBalance=!1,this._entityIds=new Set,this._boundUpdateFlowLine=this._updateFlowLine.bind(this)}shouldUpdate(e){if(e.has("config"))return this._entityIds=Ie(this.config),!0;if(e.has("hass")){const t=e.get("hass");return!t||0===this._entityIds.size||Ne(this.hass,t,this._entityIds)}return!0}_navigate(e,t,n="sensor"){De(e,this.config,t,n)}getState(e,t=2,n="",l="sensor"){return Ve(this.hass,this.config,e,t,n,l)}_renderSwitch(t,n){const l=this.getState(t,0,"","switch"),s="on"===l?"status-on":"status-off";return B(je||(je=e(['\n      <div class="button-border button-padding center clickable" @click=',">\n        ",': <span class="','">',"</span>\n      </div>\n    "])),(e=>this._navigate(e,t,"switch")),Oe("switches."+n),s,l.toUpperCase())}configOrEnum(e){return Ue(this.config,e)}render(){if(Ee.hass=this.hass,!this.hass||!this.config)return B(ze||(ze=e([""])));const t=this.config.title||"Bat 1";this.maxDeltaV=parseFloat(this.getState(ue.delta_cell_voltage,3,"0"));const n=parseFloat(this.getState(ue.balancing_current,2,"0")),l=parseFloat(this.getState(ue.power,2,"0")),s=Number(this.getState(ue.balance_trigger_voltage,2,"","number")),a=this.getState(ue.power_tube_temperature),i=Pe(this.hass,this.config);this.shouldBalance=this.maxDeltaV>=s;const r=l>0?"power-positive":l<0?"power-negative":"power-even",c=n>0?"balance-positive":n<0?"balance-negative":"balance-even",o=this.shouldBalance?"delta-needs-balancing":"delta-ok",_=this.getState(ue.total_runtime_formatted),h=_&&"unknown"!=_?B(Le||(Le=e([' | Time: <b><font color="#3090C7">',"</font></b>"])),_.toUpperCase()):"";return B(Re||(Re=e(['\n      <ha-card>\n        <div class="grid grid-1 p-3 section-padding">\n          <div class="center clickable" @click=',">\n            ","",'\n          </div>\n        </div>\n\n        <div class="grid grid-','">\n          ',"\n          ","\n          ","\n          ","\n        </div>\n          \n          ",'\n\n        <div class="grid grid-2 section-padding">\n          <div class="stats-padding stats-border">\n            <div class="clickable center" @click=','>\n              <b><font color="#41CD52" size="6">'," V</font></b>\n            </div>\n              ",' <span class="clickable ','" @click=',">"," W</span><br>\n              ",' <span class="clickable" @click=',">"," Ah</span><br>\n              ",' <span class="clickable" @click=',">"," Ah</span><br>\n              ",' <span class="clickable" @click=',">"," V</span><br>\n              ",' <span class="','">'," A</span>\n              ",'\n          </div>\n\n          <div class="stats-padding stats-border">\n            <div class="clickable center" @click=','>\n              <b><font color="#41CD52" size="6">'," A</font></b>\n            </div>\n              ",' <span class="clickable" @click=',">"," %</span><br>\n              ",' <span class="clickable" @click=',">"," Ah</span><br>\n              ",' <span class="clickable" @click=',">","</span><br>\n              ",' <span class="','" @click=',"> "," </span><br>\n              ","\n              ",'\n          </div>\n        </div>\n\n          <svg class="flow-line" id="flow-svg">\n              <path id="flow-path" fill="none" />\n          </svg>\n\n          <div class="grid grid-','">\n          ',"\n        </div>\n      </ha-card>\n    "])),(e=>this._navigate(e,ue.total_runtime_formatted)),t,h,"1"==this.config.hasHeater?"4":"3",this._renderSwitch(ue.charging,"charge"),this._renderSwitch(ue.discharging,"discharge"),this._renderSwitch(ue.balancer,"balance"),"1"==this.config.hasHeater?this._renderSwitch(ue.heater,"heater"):"",this._renderError(),(e=>this._navigate(e,ue.total_voltage)),this.getState(ue.total_voltage),Oe("stats.power"),r,(e=>this._navigate(e,ue.power)),this.getState(ue.power),Oe("stats.capacity"),(e=>this._navigate(e,ue.total_battery_capacity_setting)),this.getState(ue.total_battery_capacity_setting),Oe("stats.cycleCapacity"),(e=>this._navigate(e,ue.total_charging_cycle_capacity)),this.getState(ue.total_charging_cycle_capacity),Oe("stats.averageCellV"),(e=>this._navigate(e,ue.average_cell_voltage)),this.getState(ue.average_cell_voltage,3),Oe("stats.balanceCurrent"),c,n.toFixed(1),this._renderTemps(1),(e=>this._navigate(e,ue.current)),this.getState(ue.current),Oe("stats.stateOfCharge"),(e=>this._navigate(e,ue.state_of_charge)),this.getState(ue.state_of_charge),Oe("stats.remainingAmps"),(e=>this._navigate(e,ue.capacity_remaining)),this.getState(ue.capacity_remaining),Oe("stats.cycles"),(e=>this._navigate(e,ue.charging_cycles)),this.getState(ue.charging_cycles),Oe("stats.delta"),o,(e=>this._navigate(e,ue.delta_cell_voltage)),Te(this.config.deltaVoltageUnit,this.maxDeltaV),a?B(He||(He=e(["",' <span class="clickable" @click=',">"," ","</span>"])),Oe("stats.mosfetTemp"),(e=>this._navigate(e,ue.power_tube_temperature)),a,i):"",this._renderTemps(2),this.config.cellColumns??2,this._renderCells("bankMode"==this.config.cellLayout))}updated(){requestAnimationFrame((()=>this._updateFlowLine()))}connectedCallback(){super.connectedCallback(),window.addEventListener("resize",this._boundUpdateFlowLine)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._boundUpdateFlowLine)}_renderError(){const t=this.getState(ue.errors,0);return t.trim().length<=1||"0"==t?B(Be||(Be=e([""]))):B(Fe||(Fe=e(['<span class="error-message">',"</span>"])),t)}_renderTemps(t){const n=[],l=this.config?.tempSensorsCount??0,s=Pe(this.hass,this.config);for(let a=t;a<=l;a+=2)n.push(B(We||(We=e(["\n                <br>",' <span class="clickable" @click=',">"," ","</span>"])),Oe("stats.temperature_sensor_"+a),(e=>this._navigate(e,ue["temperature_sensor_"+a])),this.getState(ue["temperature_sensor_"+a]),s));return B(Je||(Je=e(["",""])),n)}_renderCells(t=!0){const n=[],l=this.config?.cellColumns??2,s=this.config?.cellCount??16,a=Math.floor(s/l),i=t?Math.ceil(s/l):s,r=s%l;this.minCellId=this.getState(ue.min_voltage_cell,0),this.maxCellId=this.getState(ue.max_voltage_cell,0),this.minCellId&&this.maxCellId&&this.maxDeltaV&&0!=this.maxDeltaV||this.calculateDynamicMinMaxCellId(s);for(let e=1;e<=i;e++)if(t&&r&&e==i?n.push(this._createCell(s)):n.push(this._createCell(e)),t&&(e<i||!r))for(let t=1;t<l;t++)n.push(this._createCell(e+a*t));return B(qe||(qe=e(["",""])),n)}calculateDynamicMinMaxCellId(e){let t=1/0,n=-1/0,l=0,s=0;for(let a=1;a<=e;a++){const e=this.getState(ue["cell_voltage_".concat(a)],3,""),i=parseFloat(e);isNaN(i)||(i>n&&(n=i,s=a),i<t&&(t=i,l=a))}this.minCellId=String(l),this.maxCellId=String(s),this.maxDeltaV=Number((n-t).toFixed(3))}_createCell(t){const n=this.getState(ue["cell_voltage_".concat(t)],3,"0.0"),l=this.getState(ue["cell_resistance_".concat(t)],3),s=this.minCellId,a=this.maxCellId,i=t.toString()===s?"voltage-low":t.toString()===a?"voltage-high":"";let r=""==l?"":B(Ke||(Ke=e(['\n            <span class="clickable" @click=',">\n            / "," Ω\n          </span>"])),(e=>this._navigate(e,ue["cell_resistance_".concat(t)])),l);return B(Ge||(Ge=e(['\n            <div class="center cell-container" id="cell-','">\n            <span class="clickable" @click=','>\n                <span class="pill">',"</span>\n            ","\n          </span>\n                ","\n            </div>\n        "])),t,(e=>this._navigate(e,ue["cell_voltage_".concat(t)])),t.toString().padStart(2,"0"),i?B(Ye||(Ye=e(['<span class="','">'," V</span>"])),i,n):B(Ze||(Ze=e([""," V"])),n),r)}_updateFlowLine(){const e=parseFloat(this.getState(ue.balancing_current,3,"0")),t=this.renderRoot.querySelector("#cell-".concat(this.minCellId)),n=this.renderRoot.querySelector("#cell-".concat(this.maxCellId)),l=this.renderRoot.querySelector("#flow-path");if(!l)return;if(!this.shouldBalance&&0===e||!t||!n)return l.setAttribute("d",""),void(l.style.display="none");l.style.display="inline";const s=(this.renderRoot instanceof ShadowRoot?this.renderRoot.host:this).getBoundingClientRect(),a=t.getBoundingClientRect(),i=e=>{const t=e.left+e.width/2<s.left+s.width/2?"right":"left";return{side:t,x:"right"===t?e.right-s.left:e.left-s.left,y:e.top+e.height/2-s.top}},r=i(n.getBoundingClientRect()),c=i(a);let o;if(r.side===c.side){const e="right"===r.side?r.x+10:r.x-10;o="M ".concat(r.x,",").concat(r.y,"\n             L ").concat(e,",").concat(r.y,"\n             L ").concat(e,",").concat(c.y,"\n             L ").concat(c.x,",").concat(c.y)}else{const e=(r.x+c.x)/2;o="M ".concat(r.x,",").concat(r.y,"\n             L ").concat(e,",").concat(r.y,"\n             L ").concat(e,",").concat(c.y,"\n             L ").concat(c.x,",").concat(c.y)}l.setAttribute("d",o)}};var et,tt,nt,lt,st,at,it,rt,ct,ot,_t,ht,dt,gt;Xe.styles=r(Qe||(Qe=e(["\n        .grid {\n            display: grid;\n            gap: 4px;\n            margin: 4px;\n        }\n\n        .grid-1 {\n            grid-template-columns: 1fr;\n        }\n\n        .grid-2 {\n            grid-template-columns: repeat(2, 1fr);\n        }\n\n        .grid-3 {\n            grid-template-columns: repeat(3, 1fr);\n        }\n\n        .grid-4 {\n            grid-template-columns: repeat(4, 1fr);\n        }\n\n        .grid-5 {\n            grid-template-columns: repeat(5, 1fr);\n        }\n\n        .grid-6 {\n            grid-template-columns: repeat(6, 1fr);\n        }\n\n        .grid-7 {\n            grid-template-columns: repeat(7, 1fr);\n        }\n\n        .grid-8 {\n            grid-template-columns: repeat(8, 1fr);\n        }\n\n        .clickable {\n            cursor: pointer;\n        }\n\n        .section-padding {\n            padding-top: 0.45rem;\n            padding-bottom: 0.75rem;\n        }\n\n        .stats-padding {\n            padding-top: 0.75rem;\n            padding-left: 0.75rem;\n        }\n\n        .power-negative {\n            color: red\n        }\n\n        .power-positive {\n            color: #41cd52\n        }\n\n        .power-even {\n            color: #808080\n        }\n\n        .balance-positive {\n            color: red\n        }\n\n        .balance-negative {\n            color: #3090C7\n        }\n\n        .balance-even {\n            color: #808080\n        }\n\n        .delta-needs-balancing {\n            color: #FFA500\n        }\n\n        .delta-ok {\n            color: #41CD52\n        }\n\n        .stats-border {\n            border-width: var(--ha-card-border-width, 1px);\n            border-style: solid;\n            border-color: var(--ha-card-border-color, var(--divider-color, #e0e0e0));\n        }\n\n        .button-border {\n            border-width: var(--ha-card-border-width, 1px);\n            border-style: solid;\n            border-color: var(--ha-card-border-color, var(--divider-color, #e0e0e0));\n        }\n\n        .error-message {\n            color: red;\n            font-style: italic;\n        }\n\n        .button-padding {\n            padding-top: 0.75rem;\n            padding-bottom: 0.75rem;\n        }\n\n        .status-on {\n            color: #41cd52;\n        }\n\n        .status-off {\n            color: red;\n        }\n\n        .voltage-high {\n            color: #3090C7;\n        }\n\n        .voltage-low {\n            color: red;\n        }\n\n        .center {\n            text-align: center;\n        }\n\n        .pill {\n            display: inline-block;\n            padding: 0.15rem 0.25rem;\n            background-color: #195569;\n            color: #e4f3f8;\n            border-radius: 999px;\n            font-weight: 500;\n            font-family: sans-serif;\n            font-size: 0.9rem;\n            min-width: 2rem;\n            text-align: center;\n        }\n\n        .flow-line {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            pointer-events: none;\n            z-index: 1;\n        }\n\n        line {\n            stroke: #3090C7;\n            stroke-width: 2;\n            stroke-dasharray: 6;\n            animation: dashmove 1s linear infinite;\n            filter: drop-shadow(0 0 4px #41cd52);\n        }\n\n        path {\n            stroke: #3090C7;\n            stroke-width: 3;\n            stroke-linecap: round;\n            fill: none;\n            stroke-dasharray: 10;\n            stroke-dashoffset: 0;\n            animation: dashmove 1.2s linear infinite;\n            filter: drop-shadow(0 0 4px #41cd52);\n        }\n\n        @keyframes dashmove {\n            from {\n                stroke-dashoffset: 0;\n            }\n            to {\n                stroke-dashoffset: -20;\n            }\n        }\n    "]))),t([de()],Xe.prototype,"hass",void 0),t([de()],Xe.prototype,"config",void 0),Xe=t([oe("jk-bms-default-layout")],Xe);let pt=class extends re{constructor(){super(...arguments),this.minCellId="",this.maxCellId="",this.maxDeltaV=0,this.shouldBalance=!1,this.historyData={},this._entityIds=new Set}shouldUpdate(e){if(e.has("config"))return this._entityIds=Ie(this.config),!0;if(e.has("historyData"))return!0;if(e.has("hass")){const t=e.get("hass");return!t||0===this._entityIds.size||Ne(this.hass,t,this._entityIds)}return!0}firstUpdated(){this.fetchHistory(),this._historyInterval=window.setInterval((()=>this.fetchHistory()),6e4)}_navigate(e,t,n="sensor"){De(e,this.config,t,n)}updated(e){e.has("hass")&&!e.has("historyData")&&this._updateRealtimeHistory()}_updateRealtimeHistory(){if(!this.hass||!this.config)return;const e=[ue.total_voltage,ue.current,ue.power_tube_temperature,ue.delta_cell_voltage],t=Date.now()-36e5;e.forEach((e=>{const n=this._resolveEntityId(e);if(!n)return;const l=this.hass.states[n];if(!l)return;const s=parseFloat(l.state),a=new Date(l.last_updated).getTime();if(isNaN(s))return;const i=this.historyData[n]||[],r=i.length>0?i[i.length-1]:null;if(!r||a>r.time){const e=[...i,{state:s,time:a}];for(;e.length>0&&e[0].time<t;)e.shift();this.historyData={...this.historyData,[n]:e}}}))}disconnectedCallback(){super.disconnectedCallback(),this._historyInterval&&clearInterval(this._historyInterval)}async fetchHistory(){if(!this.hass||!this.config)return;const e=[this._resolveEntityId(ue.total_voltage),this._resolveEntityId(ue.current),this._resolveEntityId(ue.power_tube_temperature),this._resolveEntityId(ue.delta_cell_voltage)].filter((e=>e)),t=[...new Set(e)];if(0===t.length)return;const n=new Date,l=new Date(n.getTime()-36e5);try{const e=await this.hass.callWS({type:"history/history_during_period",start_time:l.toISOString(),end_time:n.toISOString(),entity_ids:t,minimal_response:!0,no_attributes:!0});if(e){const t={};Object.keys(e).forEach((n=>{const l=e[n];Array.isArray(l)&&(t[n]=l.map((e=>({state:parseFloat(e.s||e.state),time:1e3*(e.lu||new Date(e.last_updated).getTime()/1e3)}))).filter((e=>!isNaN(e.state))))})),this.historyData={...this.historyData,...t}}}catch(e){console.warn("JK BMS Card: Failed to fetch history via WS",e)}}configOrEnum(e){return Ue(this.config,e)}_resolveEntityId(e){const t=this.configOrEnum(e);if(t)return t.includes(".")?t:"sensor.".concat(this.config.prefix,"_").concat(t)}_renderSparkline(t,n){const l=this._resolveEntityId(t);if(!l||!this.historyData[l]||this.historyData[l].length<2)return B(et||(et=e(['\n                <div style="height: 30px;"></div>'])));const s=this.historyData[l];let a=1/0,i=-1/0;s.forEach((e=>{const t=Number(Number(e.state).toFixed(3));t<a&&(a=t),t>i&&(i=t)}));let r=i-a;if(r<1){const e=(a+i)/2;a=e-.5,i=e+.5}else a-=.05*r,i+=.05*r;const c=s[0].time,o=s[s.length-1].time-c;if(o<=0)return B(tt||(tt=e([""])));let _="";return s.forEach(((e,t)=>{const n=(e.time-c)/o*100,l=100-(e.state-a)/(i-a)*100;_+="".concat(0===t?"M":"L"," ").concat(n.toFixed(1),",").concat(l.toFixed(1)," ")})),B(nt||(nt=e(['\n            <div class="sparkline-container">\n                <svg class="sparkline-svg" viewBox="0 0 100 100" preserveAspectRatio="none">\n                    <path class="spark-line" d="','" stroke="','"/>\n                    <path class="spark-area" d="',' L 100,100 L 0,100 Z" fill="','"/>\n                </svg>\n            </div>\n        '])),_,n,_,n)}getState(e,t=2,n="",l="sensor"){return Ve(this.hass,this.config,e,t,n,l)}render(){if(Ee.hass=this.hass,!this.hass||!this.config)return B(lt||(lt=e([""])));const t=this.config.title||"Bat 1",n=this.getState(ue.total_runtime_formatted),l=n&&"unknown"!=n?B(st||(st=e([" | Time: <b>","</b>"])),n.toUpperCase()):"",s=parseFloat(this.getState(ue.current)),a=s>0,i=s<0,r="on"===this.getState(ue.charging,0,"","switch"),c="on"===this.getState(ue.discharging,0,"","switch"),o=this.getState(ue.state_of_charge);this.getState(ue.total_battery_capacity_setting);const _=this.getState(ue.total_voltage),h=this.getState(ue.power_tube_temperature);return this.calculateDynamicMinMax(),B(at||(at=e(['\n            <ha-card class="container">\n                <div class="header clickable" @click=',">\n                    "," ",'\n                </div>\n\n                <div class="top-section">\n                    \x3c!-- Solar/Grid Node --\x3e\n                    <div class="flow-node">\n                        <div class="icon-circle clickable"\n                             @click=','>\n                            <ha-icon icon="mdi:solar-power"></ha-icon>\n                        </div>\n                        <div class="node-label">Grid/Solar</div>\n                        <div class="node-status">\n                            Charge: <span\n                                class="','">','</span>\n                        </div>\n                    </div>\n\n                    \x3c!-- Reactor (SOC) --\x3e\n                    <div class="reactor-container">\n                        <div class="reactor-ring clickable"\n                             @click=','>\n                            <div class="soc-label">SOC:</div>\n                            <div class="soc-value">','%</div>\n                            <div class="capacity-val clickable"\n                                 @click=',">\n                                Remaining:<br>",' Ah\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Load Node --\x3e\n                    <div class="flow-node">\n                        <div class="icon-circle clickable"\n                             @click=','>\n                            <ha-icon icon="mdi:power-plug"></ha-icon>\n                        </div>\n                        <div class="node-label">Load</div>\n                        <div class="node-status">\n                            Discharge: <span\n                                class="','">','</span>\n                        </div>\n                    </div>\n\n                    \x3c!-- SVG Flow Lines --\x3e\n                    <svg class="flow-svg" viewBox="0 0 400 180" preserveAspectRatio="none">\n                        \x3c!-- Left path (Charge) - Rough coordinates for now, will refine --\x3e\n                        <path d="M 60,70 Q 120,70 125,90" class="','"/>\n                        \x3c!-- Right path (Discharge) --\x3e\n                        <path d="M 275,90 Q 280,70 340,70"\n                              class="','"\n                              marker-end="url(#arrow)"/>\n\n                        <defs>\n                            <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto"\n                                    markerUnits="strokeWidth">\n                                <path d="M0,0 L0,6 L9,3 z" fill="','"/>\n                            </marker>\n                        </defs>\n                    </svg>\n                </div>\n\n                \x3c!-- Stats Panels --\x3e\n                <div class="middle-grid">\n                    <div class="stats-panel">\n                        <div class="metric-group">\n                            ','\n                            <div class="stat-label">Total Voltage:</div>\n                            <div class="stat-value val-white clickable"\n                                 @click=',">",' V\n                            </div>\n                        </div>\n\n                        <div class="metric-group">\n                            ','\n                            <div class="stat-label">Current:</div>\n                            <div class="stat-value val-white clickable"\n                                 @click=',">",' A\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="stats-panel">\n                        ','\n\n                        <div class="metric-group">\n                            ','\n                            <div class="stat-label">Delta ',':</div>\n                            <div class="stat-value val-green clickable"\n                                 @click=',">\n                                ",'\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Cells --\x3e\n                <div class="cell-grid grid-','">\n                    ',"\n                </div>\n\n            </ha-card>\n        "])),(e=>this._navigate(e,ue.total_runtime_formatted)),t,l,(e=>this._navigate(e,ue.charging,"switch")),r?"status-on":"status-off",r?"ON":"OFF",(e=>this._navigate(e,ue.state_of_charge)),o,(e=>this._navigate(e,ue.capacity_remaining)),this.getState(ue.capacity_remaining),(e=>this._navigate(e,ue.discharging,"switch")),c?"status-on":"status-off",c?"ON":"OFF",a?"path-charge":"path-inactive",i?"path-discharge":"path-inactive",c?"#3090c7":"#444",this._renderSparkline(ue.total_voltage,"#41CD52"),(e=>this._navigate(e,ue.total_voltage)),_,this._renderSparkline(ue.current,"#3090c7"),(e=>this._navigate(e,ue.current)),s,h?B(it||(it=e(['\n                        <div class="metric-group">\n                            ','\n                            <div class="stat-label">MOS Temp:</div>\n                            <div class="stat-value val-white clickable"\n                                 @click=',">"," ","\n                            </div>\n                        </div>"])),this._renderSparkline(ue.power_tube_temperature,"#FFA500"),(e=>this._navigate(e,ue.power_tube_temperature)),h,Pe(this.hass,this.config)):"",this._renderSparkline(ue.delta_cell_voltage,"#41CD52"),this.config.deltaVoltageUnit||"V",(e=>this._navigate(e,ue.delta_cell_voltage)),Te(this.config.deltaVoltageUnit,this.maxDeltaV),this.config.cellColumns??2,this._renderCells())}calculateDynamicMinMax(){let e=1/0,t=-1/0,n="",l="";const s=this.config.cellCount||16;for(let a=1;a<=s;a++){const s=this.getState(ue["cell_voltage_".concat(a)],3,""),i=parseFloat(s);isNaN(i)||(i<e&&(e=i,n=String(a)),i>t&&(t=i,l=String(a)))}e===1/0||t===-1/0?(this.maxDeltaV=0,this.minCellId="",this.maxCellId=""):(this.minCellId=n,this.maxCellId=l,this.maxDeltaV=parseFloat((t-e).toFixed(3)))}_renderCells(){const e=[],t="bankMode"===this.config.cellLayout,n=this.config.cellColumns||2,l=this.config.cellCount||16,s=Math.floor(l/n),a=t?Math.ceil(l/n):l,i=l%n;for(let r=1;r<=a;r++){const c=[];if(t)if(i&&r===a)c.push(l);else for(let e=0;e<n;e++){const t=r+s*e;t<=l&&c.push(t)}else c.push(r);for(const t of c)this._renderSingleCell(e,t)}return e}_renderSingleCell(t,n){const l=this.getState(ue["cell_voltage_".concat(n)],3,"0.000"),s=this.getState(ue["cell_resistance_".concat(n)],3,"0.000"),a=String(n)===this.minCellId,i=String(n)===this.maxCellId;let r=a?"cell-low":i?"cell-high":"val-white";const c=parseFloat(l),o=this.config.minCellVoltage??2.8,_=this.config.maxCellVoltage??3.65;let h=0;isNaN(c)||(h=(c-o)/(_-o)*100,h<0&&(h=0),h>100&&(h=100));const d=parseFloat(s),g=!isNaN(d)&&d>0,p=this.config.cellColorMode||"progress";let u="";if("gradient"===p){const e=[{r:180,g:60,b:60},{r:180,g:180,b:50},{r:60,g:180,b:60},{r:60,g:120,b:200},{r:90,g:60,b:200}];let t=Math.floor(h/25);t>=4&&(t=3);const n=h%25/25,l=e[t],s=e[t+1],a=Math.round(l.r+(s.r-l.r)*n),i=Math.round(l.g+(s.g-l.g)*n),r=Math.round(l.b+(s.b-l.b)*n);u="background: rgba(".concat(a,", ").concat(i,", ").concat(r,", 0.85);")}const v="gradient"===p?"background: rgba(0, 0, 0, 0.25); padding: 1px 3px; border-radius: 3px;":"",m=this.config.cellOrientation||"horizontal",f="vertical"===m?"cell-item cell-item-vertical":"cell-item";t.push(B(rt||(rt=e(['\n            <div class="','" style="','">\n                ',"\n                ","\n            </div>\n        "])),f,u,"progress"===p?B(ct||(ct=e(['\n                    <div class="cell-item-bg" style="width: ','%;"></div>'])),h):"","vertical"===m?B(ot||(ot=e(['\n                    <span class="cell-id">','</span>\n                    <span class="cell-volts ',' clickable" style="','"\n                          @click=',">"," V</span>\n                    ","\n                "])),String(n).padStart(2,"0"),r,v,(e=>this._navigate(e,ue["cell_voltage_".concat(n)])),l,g?B(_t||(_t=e(['\n                        <span class="cell-res clickable" style="','"\n                              @click=',">"," Ω</span>\n                    "])),v,(e=>this._navigate(e,ue["cell_resistance_".concat(n)])),s):""):B(ht||(ht=e(['\n                    <span class="clickable"\n                          @click=','>\n                            <span class="cell-id">','</span>\n                            <span class="cell-volts ','" style="','">'," V</span>\n                        </span>\n                    ","\n                "])),(e=>this._navigate(e,ue["cell_voltage_".concat(n)])),String(n).padStart(2,"0"),r,v,l,g?B(dt||(dt=e(['\n                        <span class="cell-res clickable" style="','"\n                              @click=',">/ "," Ω</span>\n                    "])),v,(e=>this._navigate(e,ue["cell_resistance_".concat(n)])),s):"")))}};var ut,vt,mt,ft;pt.styles=r(gt||(gt=e(["\n        :host {\n            --accent-color: #41cd52;\n            --accent-color-dim: rgba(65, 205, 82, 0.2);\n            --discharge-color: #3090c7;\n            --discharge-color-dim: rgba(48, 144, 199, 0.2);\n            --panel-bg: var(--secondary-background-color, rgba(255, 255, 255, 0.05));\n            --panel-border: 1px solid var(--divider-color, rgba(255, 255, 255, 0.1));\n        }\n\n        .container {\n            font-family: 'Roboto', sans-serif;\n            color: var(--primary-text-color);\n            padding: 8px;\n            box-sizing: border-box;\n            background: var(--ha-card-background, var(--card-background-color, #1c1c1c));\n            border-radius: var(--ha-card-border-radius, 12px);\n        }\n\n        .header {\n            text-align: center;\n            font-size: 1.1em;\n            margin-bottom: 16px;\n            color: var(--secondary-text-color);\n        }\n\n        .header b {\n            color: var(--discharge-color);\n        }\n\n        /* Top Section: Flow & Reactor */\n\n        .top-section {\n            display: grid;\n            grid-template-columns: 1fr 1.2fr 1fr;\n            align-items: center;\n            margin-bottom: 16px;\n            position: relative;\n            height: 180px;\n        }\n\n        .flow-node {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            z-index: 2;\n        }\n\n        .icon-circle {\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            border: 2px solid var(--secondary-text-color);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin-bottom: 4px;\n            background: var(--secondary-background-color, #2a2a2a);\n        }\n\n        .icon-circle ha-icon {\n            --mdc-icon-size: 30px;\n        }\n\n        .node-label {\n            font-size: 0.9em;\n            color: var(--secondary-text-color);\n        }\n\n        .node-status {\n            font-size: 0.85em;\n        }\n\n        .reactor-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            position: relative;\n            z-index: 2;\n        }\n\n        .reactor-ring {\n            width: 140px;\n            height: 140px;\n            border-radius: 50%;\n            border: 6px solid var(--accent-color);\n            box-shadow: 0 0 15px var(--accent-color-dim);\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            background: radial-gradient(circle, rgba(65, 205, 82, 0.1) 0%, rgba(0, 0, 0, 0) 70%);\n        }\n\n        .soc-label {\n            font-size: 0.9em;\n            color: var(--secondary-text-color);\n        }\n\n        .soc-value {\n            font-size: 2.2em;\n            font-weight: bold;\n            color: var(--accent-color);\n        }\n\n        .capacity-val {\n            font-size: 0.85em;\n            color: var(--secondary-text-color);\n            margin-top: -4px;\n        }\n\n        /* Middle Grid */\n\n        .middle-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 8px;\n            margin-bottom: 16px;\n        }\n\n        .stats-panel {\n            background: var(--panel-bg);\n            border: var(--panel-border);\n            border-radius: 10px;\n            padding: 10px;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n        }\n\n        .stat-label {\n            font-size: 0.85em;\n            color: var(--secondary-text-color);\n            margin-bottom: 4px;\n        }\n\n        .stat-value {\n            font-size: 1.4em;\n            font-weight: bold;\n        }\n\n        .stat-sub {\n            font-size: 0.8em;\n            color: var(--secondary-text-color);\n            margin-top: 2px;\n        }\n\n        .val-white {\n            color: var(--primary-text-color);\n        }\n\n        .val-green {\n            color: var(--accent-color);\n        }\n\n        .val-blue {\n            color: var(--discharge-color);\n        }\n\n        .val-orange {\n            color: orange;\n        }\n\n        /* Cell Grid */\n\n        .cell-grid {\n            display: grid;\n            gap: 6px;\n        }\n\n        .grid-1 {\n            grid-template-columns: 1fr;\n        }\n\n        .grid-2 {\n            grid-template-columns: repeat(2, 1fr);\n        }\n\n        .grid-3 {\n            grid-template-columns: repeat(3, 1fr);\n        }\n\n        .grid-4 {\n            grid-template-columns: repeat(4, 1fr);\n        }\n\n        .grid-5 {\n            grid-template-columns: repeat(5, 1fr);\n        }\n\n        .grid-6 {\n            grid-template-columns: repeat(6, 1fr);\n        }\n\n        .grid-7 {\n            grid-template-columns: repeat(7, 1fr);\n        }\n\n        .grid-8 {\n            grid-template-columns: repeat(8, 1fr);\n        }\n\n        .cell-item {\n            background: var(--secondary-background-color, #2a2a2a);\n            border-radius: 8px;\n            padding: 4px 6px;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            gap: 4px;\n            font-size: 0.85em;\n            position: relative;\n            overflow: hidden;\n            z-index: 0;\n        }\n\n        .cell-item-vertical {\n            flex-direction: column;\n            justify-content: center;\n            padding: 6px 4px;\n            gap: 3px;\n        }\n\n        .cell-item-vertical .cell-id {\n            margin-right: 0;\n            margin-bottom: 2px;\n        }\n\n        .cell-item-bg {\n            position: absolute;\n            top: 0;\n            left: 0;\n            height: 100%;\n            background: rgba(48, 144, 199, 0.2);\n            z-index: -1;\n            transition: width 0.5s ease-out;\n        }\n\n        .cell-id {\n            display: inline-block;\n            padding: 0.1rem 0.25rem;\n            background-color: #195569;\n            color: #e4f3f8;\n            border-radius: 999px;\n            font-weight: 500;\n            font-size: 0.7em;\n            min-width: 1.4rem;\n            text-align: center;\n            margin-right: 3px;\n            flex-shrink: 0;\n        }\n\n        .cell-volts {\n            color: var(--primary-text-color);\n            font-family: monospace;\n            font-size: 0.9em;\n        }\n\n        .cell-res {\n            color: var(--secondary-text-color);\n            font-size: 0.8em;\n            font-family: monospace;\n        }\n\n        .cell-low {\n            color: #FFA500;\n        }\n\n        /* Example warning color */\n\n        .cell-high {\n            color: var(--discharge-color);\n        }\n\n        .status-on {\n            color: var(--accent-color);\n            font-weight: bold;\n        }\n\n        .status-off {\n            color: var(--disabled-text-color, #666);\n            font-weight: bold;\n        }\n\n        .clickable {\n            cursor: pointer;\n        }\n\n        /* SVG Overlay for Lines */\n\n        .flow-svg {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            pointer-events: none;\n            z-index: 1;\n        }\n\n        .flow-svg path {\n            fill: none;\n            stroke-width: 2;\n            stroke-dasharray: 8;\n            animation: flow 1s linear infinite;\n        }\n\n        .path-charge {\n            stroke: var(--accent-color);\n        }\n\n        .path-discharge {\n            stroke: var(--discharge-color);\n        }\n\n        .path-inactive {\n            stroke: #444;\n            stroke-dasharray: 0;\n            animation: none;\n        }\n\n        @keyframes flow {\n            from {\n                stroke-dashoffset: 16;\n            }\n            to {\n                stroke-dashoffset: 0;\n            }\n        }\n\n        /* Sparkline CSS */\n        /* Sparkline CSS */\n\n        .metric-group {\n            position: relative;\n            width: 100%;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            padding: 8px 0;\n            z-index: 1;\n        }\n\n        .sparkline-container {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            overflow: hidden;\n            opacity: 0.3;\n            z-index: -1;\n            pointer-events: none;\n        }\n\n        .sparkline-svg {\n            width: 100%;\n            height: 100%;\n        }\n\n        .spark-line {\n            fill: none;\n            stroke-width: 2;\n            vector-effect: non-scaling-stroke;\n        }\n\n        .spark-area {\n            fill-opacity: 0.2;\n            stroke: none;\n        }\n    "]))),t([de()],pt.prototype,"hass",void 0),t([de()],pt.prototype,"config",void 0),t([de()],pt.prototype,"historyData",void 0),pt=t([oe("jk-bms-core-reactor-layout")],pt);const bt="1.2.4";console.groupCollapsed("%c🔋 JK-BMS Battery Card%c   ready!  🚀 (v".concat(bt,")"),"background: linear-gradient(to right, #41cd52, #3090c7); color: white; font-weight: bold; padding: 2px 8px; border-radius: 6px;","background: none; color: #AAA; font-style: italic;"),console.log("%c📖 Docs:","color: #41cd52; font-weight: bold;","https://github.com/Pho3niX90/jk-bms-card"),console.groupEnd();let yt=ft=class extends re{constructor(){super(...arguments),this._entityIds=new Set}setConfig(e){this._config=ft.getStubConfig(),this._config={...this._config,...e},this._entityIds=Ie(this._config)}shouldUpdate(e){if(e.has("_config"))return!0;if(e.has("hass")){const t=e.get("hass");return!t||0===this._entityIds.size||Ne(this.hass,t,this._entityIds)}return!0}static getStubConfig(){return{title:Oe("title"),prefix:"jk_bms",source:"jk-bms",bmsType:"jk-ble",cellCount:16,cellColumns:2,cellLayout:"bankMode",tempSensorsCount:0,hasHeater:0,entities:Object.keys(ue).reduce(((e,t)=>(e[t]="",e)),{})}}static async getConfigElement(){return await Promise.resolve().then((function(){return Ct})),document.createElement(ge)}getCardSize(){return 3}render(){return Ee.hass=this.hass,this.hass&&this._config?"core-reactor"===this._config.layout?B(vt||(vt=e(["<jk-bms-core-reactor-layout .hass="," .config=","></jk-bms-core-reactor-layout>"])),this.hass,this._config):B(mt||(mt=e(["\n    <jk-bms-default-layout .hass="," .config = ","></jk-bms-default-layout>\n        "])),this.hass,this._config):B(ut||(ut=e([""])))}};var wt,xt;t([de()],yt.prototype,"hass",void 0),t([de()],yt.prototype,"_config",void 0),yt=ft=t([oe(pe)],yt),window.customCards.push({type:pe,name:"JK BMS Card",preview:!0,description:Oe("common.description"),configurable:!0});let St=class extends re{constructor(){super(...arguments),this._schema=null,this._computeLabelCallback=e=>Oe("config.".concat(e.name))??e.name,this._valueChanged=e=>{!function(e,t,n,l){l=l||{},n=null==n?{}:n;const s=new Event(t,{bubbles:void 0===l.bubbles||l.bubbles,cancelable:Boolean(l.cancelable),composed:void 0===l.composed||l.composed});s.detail=n,e.dispatchEvent(s)}(this,"config-changed",{config:e.detail.value})}}setConfig(e){this._config={...this._config,...e},this._schema=null}shouldUpdate(e){if(e.has("_config"))return this._schema=null,!0;if(e.has("hass")){if(!e.get("hass"))return!0;const t=this.shadowRoot?.querySelector("ha-form");return t&&(t.hass=this.hass),!1}return!1}_buildSchema(){if(this._schema)return this._schema;const e=Object.values(ue).filter((e=>!e.startsWith("cell_voltage_")&&!e.startsWith("cell_resistance_"))).map((e=>({name:e,selector:{entity:{}}})));return this._schema=[{type:"grid",title:Oe("config.source"),schema:[{type:"grid",schema:[{name:"source",selector:{select:{options:[{label:"JK BMS (direct)",value:"jk-bms"},{label:"YamBMS (sub-device)",value:"yambms"}]}}},..."yambms"===this._config?.source?[{name:"bmsType",selector:{select:{options:[{label:"JK BMS (BLE)",value:"jk-ble"},{label:"JK BMS (RS485)",value:"jk-rs485"},{label:"Ecoworthy",value:"ecoworthy"},{label:"EG4",value:"eg4"},{label:"JBD",value:"jbd"},{label:"PACE",value:"pace"},{label:"SEPLOS V1/V2",value:"seplos-v1v2"},{label:"SEPLOS V3",value:"seplos-v3"},{label:"BASEN",value:"basen"},{label:"DEYE CAN",value:"deye"},{label:"Other",value:"other"}]}}}]:[]]}]},{type:"grid",title:Oe("config.title"),schema:[{type:"grid",schema:[{name:"title",selector:{text:{}}}]}]},{type:"grid",title:Oe("config.prefix"),schema:[{type:"grid",schema:[{name:"prefix",selector:{text:{}}}]}]},{type:"grid",title:Oe("config.layout"),schema:[{type:"grid",schema:[{name:"layout",selector:{select:{options:[{label:"Default",value:"default"},{label:"Core Reactor",value:"core-reactor"}]}}},{name:"deltaVoltageUnit",selector:{select:{options:[{label:"Volts (V)",value:"V"},{label:"Millivolts (mV)",value:"mV"}]}}},{name:"minCellVoltage",selector:{number:{min:2,max:4,step:.01,mode:"box"}}},{name:"tempUnit",selector:{select:{options:[{label:"Auto (from entity)",value:"auto"},{label:"Celsius (°C)",value:"°C"},{label:"Fahrenheit (°F)",value:"°F"}]}}}]},{type:"grid",column_min_width:"200px",schema:[{name:"cellColorMode",selector:{select:{options:[{label:"Progress Bar",value:"progress"},{label:"Voltage Gradient",value:"gradient"}]}}},{name:"cellOrientation",selector:{select:{options:[{label:"Vertical",value:"vertical"},{label:"Horizontal",value:"horizontal"}]}}},{name:"maxCellVoltage",selector:{number:{min:2,max:4,step:.01,mode:"box"}}}]}]},{type:"grid",title:Oe("config.cellCount"),schema:[{type:"grid",schema:[{name:"cellCount",selector:{number:{min:2,max:48,step:2}}},{name:"cellColumns",selector:{number:{min:1,max:8,step:1}}},{name:"cellLayout",selector:{select:{options:[{label:"Incremental",value:"incremental"},{label:"Bank Mode",value:"bankMode"}]}}}]}]},{type:"grid",title:Oe("config.tempSensorsCount"),schema:[{type:"grid",schema:[{name:"tempSensorsCount",selector:{number:{min:0,max:4,step:2}}}]}]},{type:"grid",title:Oe("config.hasHeater"),schema:[{type:"grid",schema:[{name:"hasHeater",selector:{select:{multiple:!1,mode:"list",options:[{label:"Yes",value:"1"},{label:"No",value:"0"}]}}}]}]},{type:"expandable",title:Oe("config.manualAssignment"),schema:[{name:"entities",type:"grid",schema:e}]}],this._schema}render(){return this._config&&this.hass?B(xt||(xt=e(["\n            <ha-form\n                .hass=","\n                .data=","\n                .computeLabel=","\n                .schema=","\n                @value-changed=","\n            ></ha-form>\n        "])),this.hass,this._config,this._computeLabelCallback,this._buildSchema(),this._valueChanged):B(wt||(wt=e([""])))}};t([de()],St.prototype,"hass",void 0),t([de()],St.prototype,"_config",void 0),St=t([oe(ge)],St);var Ct=Object.freeze({__proto__:null,get JkBmsCardEditor(){return St}});export{bt as CARD_VERSION,yt as JkBmsCard};
